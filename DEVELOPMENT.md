
# 小屿和 - 开发文档

## 1. 项目概述

小屿和是一个智能疗愈伴侣应用，为渴望片刻喘息的都市岛民提供精神自留地。

**品牌 Slogan**: 和自己，好好在一起

**当前版本**: v2.3.0 (Immersion Experience)

**品牌命名规范**: 详见 [brand_naming_specification.md](../../docs/brand_naming_specification.md)

---

## 2. 线香产品规格

### 2.1 SKU 概览

首发 3 款线香，采用"心理坐标"命名法：

| 正式名称 | 内部代号 | 心理坐标 | Slogan 延展 |
| :--- | :--- | :--- | :--- |
| **听荷** | 莲蕊 | 澄澈：独处的静谧时刻 | 和清静在一起 |
| **晚巷** | 木樨 | 安抚：卸下防备的温暖归途 | 和温柔在一起 |
| **小院** | 绿薄荷 | 呼吸：都市中的自然野趣 | 和自在在一起 |

### 2.2 香型与音频映射

| 香型 | Layer 1 场景音 | 视觉色调 |
| :--- | :--- | :--- |
| **听荷** | 水滴声 + 晨间鸟鸣 | 🪷 莲粉 |
| **晚巷** | 秋雨声 + 晚风 | 🟡 桂金 |
| **小院** | 森林环境音 + 草叶沙沙 | 🟢 苔绿 |

---

## 3. 核心体验流程

### 3.0 仪表盘 (Dashboard) - 入口
*   **功能**: 展示香型卡片（听荷、晚巷、小院）
*   **交互**: 点击卡片直接进入沉浸页
*   **视觉**: 多巴胺配色卡片 + 品牌生活理念

### 3.1 仪式页 (Ritual) - 可选入口
*   **视觉风格**: 沉浸式暗色调 (`#121212`)
*   **交互**: 上划屏幕，模拟"点一支香"
*   **烟雾引擎**: Canvas 粒子系统

### 3.2 沉浸页 (Immersion)
*   **双层音频系统**:
    *   **Layer 1 (场景音)**: 基础白噪音背景 (`currentAudioUrl`)
    *   **Layer 2 (功能底噪)**: 可叠加的功能噪音 (`layer2AudioUrl`)
        | 模式 | ID | 音频类型 |
        |------|-----|---------|
        | 🍃 本味 | `original` | 无叠加 |
        | 🌙 入眠 | `sleep` | 粉红噪音 |
        | 💨 冥想 | `meditate` | 棕色噪音 |
*   **动态诗歌**: 根据所选香型显示对应场景描述诗歌
    | 香型 | 诗歌片段 |
    |------|----------|
    | **听荷** | 荷塘无声 / 晨露在碧绿的荷叶间 / 轻轻滚动 / 此间独坐 / 听荷声 / 见清静 |
    | **晚巷** | 老巷深处 / 秋雨过后，夕阳在青石板上 / 染了一层金 / 此间驻足 / 寻香去 / 见温柔 |
    | **小院** | 山间小院 / 苔藓在石阶上 / 静静生长 / 此间躺卧 / 听风过 / 见自在 |
*   **计时**: 10 分钟 (`IMMERSION_DURATION = 600,000ms`)

### 3.3 树洞页 (Treehole)
*   **简化流程**:
    1. 心情选择 (有点焦虑、有点累、有点乱、有点难过、想静静、小确幸)
    2. 场景识别 (工作/学业、感情、健康/身材、家庭、人际关系、说不清)
    3. 小屿的回信 (AI 生成)
    4. 同频回响 (匿名邻居分享)

---

## 4. 品牌用词规范

### 4.1 Do (提倡)

| 推荐用词 | 场景 |
| :--- | :--- |
| **岛民** | 称呼用户 |
| **邻居** | App 内其他用户 |
| **带走 / 请回** | 购买行为 |
| **点一支** | 使用线香 |
| **器物** | 产品统称 |

### 4.2 Don't (禁止)

| 禁止用词 | 替代建议 |
| :--- | :--- |
| 客户 | 岛民 |
| 下单 / 购买 | 带走 / 请回 |
| 燃烧 | 点燃 / 点一支 |
| 奢侈 / 顶级 / 极致 | 用产品故事替代 |

---

## 5. 技术架构

### 5.1 组件结构
```
App.tsx
├── Phase 状态管理 (AppPhase enum)
├── AudioPlayer (Layer 1)
├── AudioPlayer (Layer 2)
├── DynamicBackground
├── Ritual (条件渲染)
├── Immersion (内联渲染)
├── Treehole (内联渲染)
└── Dashboard
```

### 5.2 核心状态

| 状态 | 类型 | 说明 |
|------|------|------|
| `phase` | `AppPhase` | 当前页面阶段 |
| `currentAudioUrl` | `string` | Layer 1 音频 URL |
| `layer2AudioUrl` | `string` | Layer 2 音频 URL |
| `activeAmbianceId` | `string` | 当前氛围模式 ID |
| `aiResult` | `TreeholeResult` | AI 回复结果 |

---

## 6. 资源配置

| 资源类型 | 用途 | 来源 |
| :--- | :--- | :--- |
| 背景图片 | 主背景 | 腾讯云 COS |
| 音频 (Layer 1) | 场景白噪音 | 腾讯云 COS |
| 音频 (Layer 2) | 粉噪/棕噪 | 本地 `/Audio` 目录 |
| 转场音效 | 页面切换 | Pixabay CDN |

---

## 7. 版本历史

### v2.3.0 (Immersion Experience) - Current
*   [UI] **Dashboard 卡片展开重构**:
    - 移除底部浮动按钮区域
    - 将"点一支"和"查看香方"按钮整合到展开的卡片内
    - 展开卡片显示：香材标签 + 香型名称 + 故事描述 + 操作按钮
*   [UI] **"点一支"按钮样式升级**:
    - 图标: `Flame` (火焰图标，符合燃香意境)
    - 背景: `#3a3530` (深棕黑色)
    - 文字: `#f2ede4` (米白色/沙色)
    - 字体: 衬线斜体 (`font-serif italic`)
*   [UI] **香方详情弹窗重设计**:
    - 统一使用香型主题色调
    - 内容顺序：先"制香师说"，后"安心说明"
    - 移除重复的香方详情列表
*   [Feature] **沉浸页呼吸感渐变背景**:
    - 听荷: 莲粉色系渐变 (`rgba(252, 231, 243) → rgba(249, 168, 212)`)
    - 晚巷: 桂金色系渐变 (`rgba(254, 243, 199) → rgba(252, 211, 77)`)
    - 小院: 苔绿色系渐变 (`rgba(187, 247, 208) → rgba(74, 222, 128)`)
*   [Feature] **背景呼吸动画**:
    - 动画名称: `breathe`
    - 周期: 8秒 (`ease-in-out infinite`)
    - 效果: 透明度 0.5 → 1.0，缩放 1.0 → 1.03
*   [Feature] **文案呼吸动画**:
    - 动画名称: `textBreathe`
    - 周期: 4秒 (`ease-in-out infinite`)
    - 效果: 透明度 0.7 → 1.0，位移 Y: 0 → -3px
    - 错开延迟: 每行 0.8s
*   [Feature] **音频慢速淡入**:
    - 从 Dashboard 进入沉浸页时生效
    - 时长: 8秒
    - 目标音量: 90%
    - 实现方式: 160 步 × 50ms/步
*   [Test] **测试覆盖**:
    - 新增 Dashboard.test.tsx
    - 90 个测试用例全部通过
    - TDD 开发流程
*   [Refactor] **组件更新**:
    - `App.tsx`: 添加 `scentId` 传递给 `DynamicBackground`，更新音频淡入逻辑
    - `Dashboard.tsx`: 展开卡片 UI 重构，按钮样式更新
    - `DynamicBackground.tsx`: 新增 `scentId` prop，香型特定渐变色
    - `index.html`: 添加 `breathe` 和 `textBreathe` 动画

### v2.2.0 (Brand Aligned)
*   [Brand] **品牌命名规范**: 采用"心理坐标"命名法
*   [Brand] **线香重命名**: 听荷、晚巷、小院 (原：白茶、木樨、蔷薇)
*   [Brand] **Slogan 更新**: "和自己，好好在一起"
*   [Brand] **用词规范**: 使用"岛民"、"点一支香"、"带走"等品牌词汇
*   [Brand] **心情选项优化**: 有点累、有点乱、有点难过、想静静
*   [Feature] **沉浸页动态诗歌**: 每款香型拥有独特的场景描述诗歌
    - 听荷: "荷塘无声 / 晨露在碧绿的荷叶间 / 轻轻滚动..."
    - 晚巷: "老巷深处 / 秋雨过后，夕阳在青石板上 / 染了一层金..."
    - 小院: "山间小院 / 苔藓在石阶上 / 静静生长..."
*   [Refactor] **代码更新**: App.tsx 新增 `getImmersionPoem()` 动态诗歌选择函数
*   [Refactor] **常量更新**: constants.ts 更新 FRAGRANCE_LIST、TEXT_CONTENT 等配置

### v2.1.0 (Dual Layer Audio)
*   [Feature] 双层音频系统
*   [Feature] 三种氛围模式
*   [Refactor] 树洞流程简化

### v1.2.2 (Visual Polish)
*   沉浸式暗黑模式
*   烟雾粒子算法升级
*   无缝转场逻辑

---

## 8. 待办事项

### 优先级高
- [ ] **代码重构**: 将 App.tsx 拆分为自定义 Hooks 和子组件
- [ ] **类型完善**: 移除 `@ts-ignore` 注释
- [ ] **错误处理**: 添加音频加载失败的友好提示

### 优先级中
- [ ] 添加多语种诗歌支持
- [ ] 优化不同屏幕比例的背景图适配
- [ ] 完善品牌生活方式页面
- [ ] 添加本地音频文件的 CDN 支持

### 优先级低
- [ ] PWA 支持（离线使用）
- [ ] 用户数据持久化

---

## 9. 开发指南

### 本地开发
```bash
npm install
npm run dev
```

### 环境变量
创建 `.env.local` 文件：
```
GEMINI_API_KEY=your_api_key_here
```

### 构建生产版本
```bash
npm run build
npm run preview
```

---

*小屿和 · 和自己，好好在一起*
